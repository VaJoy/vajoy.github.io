[1,["f1KiPEuSRDIqJgPZgkKPHo@f9941","45go8ltQ1MUqWR4ZSRpiuM@f9941","11vcSwZKhOt6Knn7niM+l3@f9941","11vcSwZKhOt6Knn7niM+l3@6c48a","15jn5SMiBM15aUcT4OboJ4@6c48a","28dl4vBApMZY6M+dC7edhj@6c48a","73G+7TnaxM1ouLznowO3pI","8cj0dk9udAW4+TzaPKRnwK@f9941","28dl4vBApMZY6M+dC7edhj@f9941","91XUpUAPBEqZp5m6SwXhd0","15jn5SMiBM15aUcT4OboJ4@f9941","dfHt1Fug9FY4zwtwRdVupK@6c48a","c27BjHsmZNC7HXcHYTbAKl@6c48a","f4j0kYWmxNw6m3juVLJAnd","8cj0dk9udAW4+TzaPKRnwK@6c48a"],["node","_spriteFrame","_target","_normalSprite","_checkMark","_textureSource","_cameraComponent","_handle","root","scene","_parent","_customMaterial","asset","heightMap","normalMap","_effectAsset"],[["cc.Sprite",["_sizeMode","_name","_type","node","_spriteFrame","_customMaterial"],0,1,6,6],["cc.Node",["_name","_layer","_id","_objFlags","__editorExtras__","_components","_parent","_lpos","_children","_lscale","_prefab"],-2,9,1,5,2,5,4],"cc.SpriteFrame",["cc.Node",["_name","_layer","_active","_parent","_components","_lpos"],0,1,12,5],["cc.UITransform",["_name","node","_contentSize"],2,1,5],["cc.Toggle",["_isChecked","node","_normalColor","_target","_checkMark","_normalSprite","checkEvents"],2,1,5,1,1,6,9],["cc.Label",["_string","_actualFontSize","_fontSize","_horizontalAlign","node"],-1,1],["cc.SceneAsset",["_name"],2],["cc.Node",["_name","_parent","_components","_lpos"],2,1,2,5],["cc.Canvas",["node","_cameraComponent"],3,1,1],["cc.Widget",["_alignFlags","_isAbsBottom","node"],1,1],["c3ea7A5MMREXrL4hyUhrP85",["node"],3,1],["cc.ToggleContainer",["node","checkEvents"],3,1,9],["cc.ClickEvent",["_componentId","handler","target"],1,1],["cc.Slider",["_progress","node","slideEvents","_handle"],2,1,9,1],["cc.Button",["node","_normalColor","_target","_normalSprite"],3,1,5,1,6],["cc.TargetInfo",["localID"],2],["cc.PrefabInfo",["fileId","targetOverrides","nestedPrefabInstanceRoots","root","instance","asset"],0,1,4,6],["cc.PrefabInfo",["root","asset","fileId","instance","targetOverrides","nestedPrefabInstanceRoots"],-2,2],["cc.PrefabInstance",["fileId","prefabRootNode","propertyOverrides"],1,9],["CCPropertyOverrideInfo",["value","propertyPath","targetInfo"],1,1],["CCPropertyOverrideInfo",["propertyPath","targetInfo","value"],2,1,8],["cc.Scene",["_name","_children","_prefab","_globals"],2,2,4,4],["cc.SceneGlobals",["ambient","shadows","_skybox","fog","octree","skin","lightProbeInfo","postSettings"],3,4,4,4,4,4,4,4,4],["cc.AmbientInfo",["_skyColorHDR","_groundAlbedoHDR"],3,5,5],["cc.ShadowsInfo",["_shadowColor","_size"],3,5,5],["cc.SkyboxInfo",[],3],["cc.FogInfo",[],3],["cc.OctreeInfo",[],3],["cc.SkinInfo",["_enabled"],2],["cc.LightProbeInfo",[],3],["cc.PostSettingsInfo",[],3],["cc.Camera",["_projection","_orthoHeight","_near","_far","_visibility","node","_color"],-2,1,5],["cc.Material",["_name","_states","_defines","_props"],0,12],["cc.EffectAsset",["_name","shaders","techniques"],0]],[[4,1,2,1],[1,0,1,6,8,5,7,3],[1,0,1,6,5,7,3],[3,0,2,1,3,4,4],[0,0,3,4,2],[4,0,1,2,2],[13,0,1,2,3],[0,0,3,2],[5,0,1,2,3,4,5,2],[6,0,1,2,4,4],[21,0,1,2,2],[0,1,3,2],[6,0,3,1,2,4,5],[7,0,2],[1,0,1,2,8,5,7,4],[1,0,1,6,8,5,7,9,3],[1,0,1,6,5,3],[1,3,4,6,10,3],[3,0,1,3,4,5,3],[3,0,1,3,4,3],[8,0,1,2,3,2],[4,1,1],[9,0,1,1],[10,0,1,2,3],[11,0,1],[12,0,1,1],[0,3,4,1],[0,2,0,3,4,3],[0,3,5,4,1],[0,1,0,3,3],[5,1,2,3,4,5,1],[5,0,1,2,3,6,4,5,2],[14,0,1,2,3,2],[15,0,1,2,3,1],[16,0,2],[17,0,1,2,3,4,5,4],[18,0,1,2,3,4,5,6],[19,0,1,2,3],[20,0,1,2,3],[22,0,1,2,3,2],[23,0,1,2,3,4,5,6,7,1],[24,0,1,1],[25,0,1,1],[26,1],[27,1],[28,1],[29,0,2],[30,1],[31,1],[32,0,1,2,3,4,5,6,6],[33,0,1,2,3,4],[34,0,1,2,4]],[[[{"name":"default_toggle_normal","rect":{"x":0,"y":0,"width":28,"height":28},"offset":{"x":0,"y":0},"originalSize":{"width":28,"height":28},"rotated":false,"capInsets":[0,0,0,0],"vertices":{"rawPosition":[-14,-14,0,14,-14,0,-14,14,0,14,14,0],"indexes":[0,1,2,2,1,3],"uv":[0,28,28,28,0,0,28,0],"nuv":[0,0,1,0,0,1,1,1],"minPos":{"x":-14,"y":-14,"z":0},"maxPos":{"x":14,"y":14,"z":0}},"packable":true,"pixelsToUnit":100,"pivot":{"x":0.5,"y":0.5},"meshType":0}],[2],0,[0],[5],[3]],[[{"name":"default_toggle_checkmark","rect":{"x":4,"y":5,"width":20,"height":18},"offset":{"x":0,"y":0},"originalSize":{"width":28,"height":28},"rotated":false,"capInsets":[0,0,0,0],"vertices":{"rawPosition":[-10,-9,0,10,-9,0,-10,9,0,10,9,0],"indexes":[0,1,2,2,1,3],"uv":[4,23,24,23,4,5,24,5],"nuv":[0.14285714285714285,0.17857142857142858,0.8571428571428571,0.17857142857142858,0.14285714285714285,0.8214285714285714,0.8571428571428571,0.8214285714285714],"minPos":{"x":-10,"y":-9,"z":0},"maxPos":{"x":10,"y":9,"z":0}},"packable":true,"pixelsToUnit":100,"pivot":{"x":0.5,"y":0.5},"meshType":0}],[2],0,[0],[5],[4]],[[{"name":"default_scrollbar_bg","rect":{"x":0,"y":0,"width":30,"height":15},"offset":{"x":0,"y":0},"originalSize":{"width":30,"height":15},"rotated":false,"capInsets":[10,4,10,4],"vertices":{"rawPosition":[-15,-7.5,0,15,-7.5,0,-15,7.5,0,15,7.5,0],"indexes":[0,1,2,2,1,3],"uv":[0,15,30,15,0,0,30,0],"nuv":[0,0,1,0,0,1,1,1],"minPos":{"x":-15,"y":-7.5,"z":0},"maxPos":{"x":15,"y":7.5,"z":0}},"packable":true,"pixelsToUnit":100,"pivot":{"x":0.5,"y":0.5},"meshType":0}],[2],0,[0],[5],[5]],[[[13,"scene"],[14,"Canvas",33554432,"beI88Z2HpFELqR4T5EMHpg",[-6,-7,-8,-9,-10,-11,-12],[[0,-1,[5,1280,720]],[22,-3,-2],[23,45,false,-4],[24,-5]],[1,640,360,0]],[1,"Labels",33554432,1,[-14,-15,-16,-17,-18],[[21,-13]],[1,484.393,271.312,0]],[1,"ToggleGroup",33554432,1,[-20,-21,-22,-23],[[25,-19,[[6,"c3ea7A5MMREXrL4hyUhrP85","toggleGroupCallback",1]]]],[1,465.81,271.312,0]],[1,"Toggle1",33554432,3,[-29],[[0,-24,[5,32,32]],[4,0,-25,2],[8,false,-28,[4,4292269782],-27,-26,3]],[1,-62,0,0]],[1,"Toggle2",33554432,3,[-35],[[0,-30,[5,32,32]],[4,0,-31,4],[30,-34,[4,4292269782],-33,-32,5]],[1,-62,-80,0]],[1,"Toggle3",33554432,3,[-41],[[0,-36,[5,32,32]],[4,0,-37,6],[8,false,-40,[4,4292269782],-39,-38,7]],[1,-62,-160,0]],[1,"Toggle4",33554432,3,[-47],[[0,-42,[5,32,32]],[4,0,-43,8],[8,false,-46,[4,4292269782],-45,-44,9]],[1,-62,-282.693,0]],[1,"Toggle",33554432,1,[-53],[[0,-48,[5,28,28]],[26,-49,12],[31,false,-52,[4,4292269782],-51,[[6,"c3ea7A5MMREXrL4hyUhrP85","toggleCheck",1]],-50,13]],[1,406.92,-225.859,0]],[15,"Slider",33554432,1,[-58],[[0,-54,[5,300,20]],[27,1,0,-55,11],[32,0.15,-57,[[6,"c3ea7A5MMREXrL4hyUhrP85","sliderCallback",1]],-56]],[1,492.141,65.224,0],[1,0.7,0.7,1]],[18,"Handle",33554432,9,[[[0,-59,[5,32,32]],-60,[33,-62,[4,4292269782],-61,10]],4,1,4],[1,-105,0,0]],[34,["c46/YsCPVOJYA4mWEpNYRx"]],[16,"Wall",33554432,1,[[0,-63,[5,700,700]],[28,-64,0,1]]],[3,"Checkmark",false,33554432,4,[[[0,-65,[5,32,32]],-66],4,1]],[19,"Checkmark",33554432,5,[[[5,"Checkmark<UITransformComponent>",-67,[5,32,32]],-68],4,1]],[3,"Checkmark",false,33554432,6,[[[5,"Checkmark<UITransformComponent>",-69,[5,32,32]],-70],4,1]],[3,"Checkmark",false,33554432,7,[[[5,"Checkmark<UITransformComponent>",-71,[5,32,32]],-72],4,1]],[2,"Label",33554432,2,[[0,-73,[5,59.994963639937104,50.4]],[9,"无光照",29.8125,20,-74]],[1,-15.491,0,0]],[2,"Label-001",33554432,2,[[0,-75,[5,59.994963639937104,50.4]],[9,"漫反射",29.8125,20,-76]],[1,-15.491,-81.765,0]],[2,"Label-002",33554432,2,[[0,-77,[5,79.99328485324948,50.4]],[12,"镜面反射",0,29.8125,20,-78]],[1,-6.824,-159.814,0]],[2,"Label-003",33554432,2,[[0,-79,[5,68.91995667911425,50.4]],[12,"Toon 光",0,29.8125,20,-80]],[1,-11.236,-281.9,0]],[2,"Label-004",33554432,2,[[0,-81,[5,99.99160606656184,50.4]],[9,"使用高度图",29.8125,20,-82]],[1,6.876,-496.532,0]],[3,"Checkmark",false,33554432,8,[[[0,-83,[5,26,26]],-84],4,1]],[17,0,{},1,[35,"c46/YsCPVOJYA4mWEpNYRx",null,null,-85,[37,"ea64SizGtFO7Npx8CEv2Bg",null,[[38,"BackBtn",["_name"],11],[10,["_lpos"],11,[1,-570.748,320.372,0]],[10,["_lrot"],11,[3,0,0,0,1]],[10,["_euler"],11,[1,0,0,0]]]],14]],[39,"scene",[1],[36,null,null,"47e0ad84-1a80-4933-8e8b-65ed45727f86",null,null,[23]],[40,[41,[2,0,0,0,0.520833125],[2,0,0,0,0]],[42,[4,4283190348],[0,512,512]],[43],[44],[45],[46,false],[47],[48]]],[20,"Camera",1,[-86],[1,0,0,1000]],[49,0,592.3689727463312,0,2000,1108344832,25,[4,4278190080]],[7,0,13],[29,"Checkmark<SpriteComponent>",0,14],[11,"Checkmark<SpriteComponent>",15],[11,"Checkmark<SpriteComponent>",16],[7,0,10],[7,0,22]],0,[0,0,1,0,6,26,0,0,1,0,0,1,0,0,1,0,-1,25,0,-2,12,0,-3,3,0,-4,2,0,-5,9,0,-6,8,0,-7,23,0,0,2,0,-1,17,0,-2,18,0,-3,19,0,-4,20,0,-5,21,0,0,3,0,-1,4,0,-2,5,0,-3,6,0,-4,7,0,0,4,0,0,4,0,4,27,0,2,4,0,0,4,0,-1,13,0,0,5,0,0,5,0,4,28,0,2,5,0,0,5,0,-1,14,0,0,6,0,0,6,0,4,29,0,2,6,0,0,6,0,-1,15,0,0,7,0,0,7,0,4,30,0,2,7,0,0,7,0,-1,16,0,0,8,0,0,8,0,4,32,0,2,8,0,0,8,0,-1,22,0,0,9,0,0,9,0,7,31,0,0,9,0,-1,10,0,0,10,0,-2,31,0,2,10,0,0,10,0,0,12,0,0,12,0,0,13,0,-2,27,0,0,14,0,-2,28,0,0,15,0,-2,29,0,0,16,0,-2,30,0,0,17,0,0,17,0,0,18,0,0,18,0,0,19,0,0,19,0,0,20,0,0,20,0,0,21,0,0,21,0,0,22,0,-2,32,0,8,23,0,-1,26,0,9,24,1,10,24,86],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,27,28,29,30,31,32],[11,1,1,3,1,3,1,3,1,3,3,1,1,3,12,1,1,1,1,1,1],[6,7,0,0,0,0,0,0,0,0,0,8,2,2,9,1,1,1,1,0,10]],[[[50,"material",[{"rasterizerState":{},"depthStencilState":{},"blendState":{"targets":[{}]}}],[{}],[[[{},"heightMap",6,0,"normalMap",6,1]],11]]],0,0,[0,0,0],[13,14,15],[11,12,13]],[[{"name":"wall","rect":{"x":0,"y":0,"width":700,"height":700},"offset":{"x":0,"y":0},"originalSize":{"width":700,"height":700},"rotated":false,"capInsets":[0,0,0,0],"vertices":{"rawPosition":[-350,-350,0,350,-350,0,-350,350,0,350,350,0],"indexes":[0,1,2,2,1,3],"uv":[0,700,700,700,0,0,700,0],"nuv":[0,0,1,0,0,1,1,1],"minPos":{"x":-350,"y":-350,"z":0},"maxPos":{"x":350,"y":350,"z":0}},"packable":true,"pixelsToUnit":100,"pivot":{"x":0.5,"y":0.5},"meshType":0}],[2],0,[0],[5],[14]],[[[51,"../demo/14-maps/maps",[{"hash":3391567318,"name":"../demo/14-maps/maps|vs:vert|fs:frag","blocks":[{"name":"UBO","stageFlags":16,"binding":0,"members":[{"name":"lightColor","type":16,"count":1},{"name":"lightPos","type":14,"count":1},{"name":"shininess","type":13,"count":1},{"name":"reflectMode","type":5,"count":1},{"name":"useHeight","type":5,"count":1}],"defines":[]}],"samplerTextures":[{"name":"normalMap","type":28,"count":1,"stageFlags":16,"sampleType":0,"binding":1,"defines":[]},{"name":"heightMap","type":28,"count":1,"stageFlags":16,"sampleType":0,"binding":2,"defines":[]}],"samplers":[],"textures":[],"buffers":[],"images":[],"subpassInputs":[],"attributes":[{"name":"a_position","format":32,"location":0,"defines":[]},{"name":"a_texCoord","format":21,"location":1,"defines":[]},{"name":"a_color","format":44,"location":2,"defines":["USE_LOCAL"]}],"fragColors":[{"name":"cc_FragColor","typename":"vec4","type":16,"count":1,"stageFlags":16,"location":0,"defines":[]}],"descriptors":[{"rate":0,"blocks":[{"name":"CCLocal","stageFlags":1,"tags":{"builtin":"local"},"members":[{"name":"cc_matWorld","typename":"mat4","type":25,"count":1,"precision":"highp "},{"name":"cc_matWorldIT","typename":"mat4","type":25,"count":1,"precision":"highp "},{"name":"cc_lightingMapUVParam","typename":"vec4","type":16,"count":1,"precision":"highp "},{"name":"cc_localShadowBias","typename":"vec4","type":16,"count":1,"precision":"highp "},{"name":"cc_reflectionProbeData1","typename":"vec4","type":16,"count":1,"precision":"highp "},{"name":"cc_reflectionProbeData2","typename":"vec4","type":16,"count":1,"precision":"highp "},{"name":"cc_reflectionProbeBlendData1","typename":"vec4","type":16,"count":1,"precision":"highp "},{"name":"cc_reflectionProbeBlendData2","typename":"vec4","type":16,"count":1,"precision":"highp "}],"defines":["USE_LOCAL"]}],"samplerTextures":[{"name":"cc_spriteTexture","typename":"sampler2D","type":28,"count":1,"stageFlags":16,"sampleType":0,"tags":{"builtin":"local"},"defines":[]}],"samplers":[],"textures":[],"buffers":[],"images":[],"subpassInputs":[]},{"rate":1,"blocks":[{"name":"UBO","stageFlags":16,"binding":0,"members":[{"name":"lightColor","type":16,"count":1},{"name":"lightPos","type":14,"count":1},{"name":"shininess","type":13,"count":1},{"name":"reflectMode","type":5,"count":1},{"name":"useHeight","type":5,"count":1}],"defines":[]}],"samplerTextures":[{"name":"normalMap","type":28,"count":1,"stageFlags":16,"sampleType":0,"binding":1,"defines":[]},{"name":"heightMap","type":28,"count":1,"stageFlags":16,"sampleType":0,"binding":2,"defines":[]}],"samplers":[],"textures":[],"buffers":[],"images":[],"subpassInputs":[]},{"rate":2,"blocks":[],"samplerTextures":[],"samplers":[],"textures":[],"buffers":[],"images":[],"subpassInputs":[]},{"rate":3,"blocks":[{"name":"CCGlobal","stageFlags":1,"tags":{"builtin":"global"},"members":[{"name":"cc_time","typename":"vec4","type":16,"count":1,"precision":"highp "},{"name":"cc_screenSize","typename":"vec4","type":16,"count":1,"precision":"mediump "},{"name":"cc_nativeSize","typename":"vec4","type":16,"count":1,"precision":"mediump "},{"name":"cc_probeInfo","typename":"vec4","type":16,"count":1,"precision":"mediump "},{"name":"cc_debug_view_mode","typename":"vec4","type":16,"count":1,"precision":"mediump "}],"defines":[]},{"name":"CCCamera","stageFlags":1,"tags":{"builtin":"global"},"members":[{"name":"cc_matView","typename":"mat4","type":25,"count":1,"precision":"highp "},{"name":"cc_matViewInv","typename":"mat4","type":25,"count":1,"precision":"highp "},{"name":"cc_matProj","typename":"mat4","type":25,"count":1,"precision":"highp "},{"name":"cc_matProjInv","typename":"mat4","type":25,"count":1,"precision":"highp "},{"name":"cc_matViewProj","typename":"mat4","type":25,"count":1,"precision":"highp "},{"name":"cc_matViewProjInv","typename":"mat4","type":25,"count":1,"precision":"highp "},{"name":"cc_cameraPos","typename":"vec4","type":16,"count":1,"precision":"highp "},{"name":"cc_surfaceTransform","typename":"vec4","type":16,"count":1,"precision":"mediump "},{"name":"cc_screenScale","typename":"vec4","type":16,"count":1,"precision":"mediump "},{"name":"cc_exposure","typename":"vec4","type":16,"count":1,"precision":"mediump "},{"name":"cc_mainLitDir","typename":"vec4","type":16,"count":1,"precision":"mediump "},{"name":"cc_mainLitColor","typename":"vec4","type":16,"count":1,"precision":"mediump "},{"name":"cc_ambientSky","typename":"vec4","type":16,"count":1,"precision":"mediump "},{"name":"cc_ambientGround","typename":"vec4","type":16,"count":1,"precision":"mediump "},{"name":"cc_fogColor","typename":"vec4","type":16,"count":1,"precision":"mediump "},{"name":"cc_fogBase","typename":"vec4","type":16,"count":1,"precision":"mediump "},{"name":"cc_fogAdd","typename":"vec4","type":16,"count":1,"precision":"mediump "},{"name":"cc_nearFar","typename":"vec4","type":16,"count":1,"precision":"mediump "},{"name":"cc_viewPort","typename":"vec4","type":16,"count":1,"precision":"mediump "}],"defines":[]}],"samplerTextures":[],"samplers":[],"textures":[],"buffers":[],"images":[],"subpassInputs":[]}],"glsl3":{"vert":"\n  precision highp float;\n  layout(std140) uniform CCGlobal {\n    highp   vec4 cc_time;\n    mediump vec4 cc_screenSize;\n    mediump vec4 cc_nativeSize;\n    mediump vec4 cc_probeInfo;\n    mediump vec4 cc_debug_view_mode;\n  };\n  layout(std140) uniform CCCamera {\n    highp   mat4 cc_matView;\n    highp   mat4 cc_matViewInv;\n    highp   mat4 cc_matProj;\n    highp   mat4 cc_matProjInv;\n    highp   mat4 cc_matViewProj;\n    highp   mat4 cc_matViewProjInv;\n    highp   vec4 cc_cameraPos;\n    mediump vec4 cc_surfaceTransform;\n    mediump vec4 cc_screenScale;\n    mediump vec4 cc_exposure;\n    mediump vec4 cc_mainLitDir;\n    mediump vec4 cc_mainLitColor;\n    mediump vec4 cc_ambientSky;\n    mediump vec4 cc_ambientGround;\n    mediump vec4 cc_fogColor;\n    mediump vec4 cc_fogBase;\n    mediump vec4 cc_fogAdd;\n    mediump vec4 cc_nearFar;\n    mediump vec4 cc_viewPort;\n  };\n  #if USE_LOCAL\n    layout(std140) uniform CCLocal {\n      highp mat4 cc_matWorld;\n      highp mat4 cc_matWorldIT;\n      highp vec4 cc_lightingMapUVParam;\n      highp vec4 cc_localShadowBias;\n      highp vec4 cc_reflectionProbeData1;\n      highp vec4 cc_reflectionProbeData2;\n      highp vec4 cc_reflectionProbeBlendData1;\n      highp vec4 cc_reflectionProbeBlendData2;\n    };\n  #endif\n  in vec3 a_position;\n  in vec2 a_texCoord;\n  out vec2 uv;\n  #if USE_LOCAL\n    in vec4 a_color;\n    out vec4 v_color;\n  #endif\n  vec4 vert() {\n    vec4 pos = vec4(a_position, 1);\n    #if USE_LOCAL\n      pos = cc_matWorld * pos;\n      v_color = a_color;\n    #endif\n    pos = cc_matViewProj * pos;\n    uv = a_texCoord;\n    return  pos;\n  }\nvoid main() { gl_Position = vert(); }","frag":"\nprecision highp float;\nuniform sampler2D cc_spriteTexture;\nin vec2 uv;\nlayout(std140) uniform UBO {\n  vec4 lightColor;\n  vec2 lightPos;\n  float shininess;\n  int reflectMode;\n  int useHeight;\n};\nuniform sampler2D normalMap;\nuniform sampler2D heightMap;\nvec2 validLightPos () {\n  return clamp(lightPos, 0.0, 1.0);\n}\nvec3 calcDiffuse(vec3 normal, vec3 lightDir, vec3 lightColor) {\n  float NdotL = max(dot(normal, lightDir), 0.0);\n  return lightColor * NdotL;\n}\nvec3 calcBlinnPhong(vec3 normal, vec3 lightDir, vec3 viewDir, vec3 lightColor, float shininess) {\n  vec3 halfDir = normalize(lightDir + viewDir);\n  float NdotH = max(dot(normal, halfDir), 0.0);\n  float spec = pow(NdotH, shininess);\n  return lightColor * spec;\n}\nvec3 calcToon(vec3 normal, vec3 lightDir, vec3 lightColor) {\n  float NdotL = max(dot(normal, lightDir), 0.0);\n  float stepVal = step(0.5, NdotL);\n  return lightColor * stepVal;\n}\nvec3 applyReflection(\n  vec3 normal,\n  vec3 lightDir,\n  vec3 viewDir,\n  vec3 lightColor,\n  float shininess\n) {\n  if (reflectMode == 1) {\n    return calcDiffuse(normal, lightDir, lightColor);\n  }\n  else if (reflectMode == 2) {\n    return calcBlinnPhong(normal, lightDir, viewDir, lightColor, shininess);\n  }\n  else if (reflectMode == 3) {\n    return calcToon(normal, lightDir, lightColor);\n  }\n  return vec3(0.0);\n}\nvec4 frag () {\n  vec2 uvCoord = uv;\n  if (useHeight == 1) {\n    float height = texture(heightMap, uv).r;\n    vec2 viewDirXY = normalize(vec2(0.5, 0.5) - uv);\n    uvCoord += viewDirXY * (height - 0.5) * 0.02;\n  }\n  vec3 baseColor = texture(cc_spriteTexture, uvCoord).rgb;\n  if (reflectMode == 0) {\n    return vec4(baseColor, 1.0);\n  }\n  vec3 n = texture(normalMap, uvCoord).rgb * 2.0 - 1.0;\n  n = normalize(n);\n  vec3 lightDir = normalize(vec3(validLightPos() - uvCoord, 0.1));\n  vec3 viewDir = vec3(0.0, 0.0, 1.0);\n  vec3 lighting = applyReflection(n, lightDir, viewDir, lightColor.rgb, shininess);\n  vec3 finalColor = baseColor * (0.3 + lighting);\n  return vec4(finalColor, 1.0);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"},"glsl1":{"vert":"\n  precision highp float;\n  uniform highp mat4 cc_matViewProj;\n  #if USE_LOCAL\n    uniform highp mat4 cc_matWorld;\n  #endif\n  attribute vec3 a_position;\n  attribute vec2 a_texCoord;\n  varying vec2 uv;\n  #if USE_LOCAL\n    attribute vec4 a_color;\n    varying vec4 v_color;\n  #endif\n  vec4 vert() {\n    vec4 pos = vec4(a_position, 1);\n    #if USE_LOCAL\n      pos = cc_matWorld * pos;\n      v_color = a_color;\n    #endif\n    pos = cc_matViewProj * pos;\n    uv = a_texCoord;\n    return  pos;\n  }\nvoid main() { gl_Position = vert(); }","frag":"\nprecision highp float;\nuniform sampler2D cc_spriteTexture;\nvarying vec2 uv;\n   uniform vec4 lightColor;\n   uniform vec2 lightPos;\n   uniform float shininess;\n   uniform int reflectMode;\n   uniform int useHeight;\nuniform sampler2D normalMap;\nuniform sampler2D heightMap;\nvec2 validLightPos () {\n  return clamp(lightPos, 0.0, 1.0);\n}\nvec3 calcDiffuse(vec3 normal, vec3 lightDir, vec3 lightColor) {\n  float NdotL = max(dot(normal, lightDir), 0.0);\n  return lightColor * NdotL;\n}\nvec3 calcBlinnPhong(vec3 normal, vec3 lightDir, vec3 viewDir, vec3 lightColor, float shininess) {\n  vec3 halfDir = normalize(lightDir + viewDir);\n  float NdotH = max(dot(normal, halfDir), 0.0);\n  float spec = pow(NdotH, shininess);\n  return lightColor * spec;\n}\nvec3 calcToon(vec3 normal, vec3 lightDir, vec3 lightColor) {\n  float NdotL = max(dot(normal, lightDir), 0.0);\n  float stepVal = step(0.5, NdotL);\n  return lightColor * stepVal;\n}\nvec3 applyReflection(\n  vec3 normal,\n  vec3 lightDir,\n  vec3 viewDir,\n  vec3 lightColor,\n  float shininess\n) {\n  if (reflectMode == 1) {\n    return calcDiffuse(normal, lightDir, lightColor);\n  }\n  else if (reflectMode == 2) {\n    return calcBlinnPhong(normal, lightDir, viewDir, lightColor, shininess);\n  }\n  else if (reflectMode == 3) {\n    return calcToon(normal, lightDir, lightColor);\n  }\n  return vec3(0.0);\n}\nvec4 frag () {\n  vec2 uvCoord = uv;\n  if (useHeight == 1) {\n    float height = texture2D(heightMap, uv).r;\n    vec2 viewDirXY = normalize(vec2(0.5, 0.5) - uv);\n    uvCoord += viewDirXY * (height - 0.5) * 0.02;\n  }\n  vec3 baseColor = texture2D(cc_spriteTexture, uvCoord).rgb;\n  if (reflectMode == 0) {\n    return vec4(baseColor, 1.0);\n  }\n  vec3 n = texture2D(normalMap, uvCoord).rgb * 2.0 - 1.0;\n  n = normalize(n);\n  vec3 lightDir = normalize(vec3(validLightPos() - uvCoord, 0.1));\n  vec3 viewDir = vec3(0.0, 0.0, 1.0);\n  vec3 lighting = applyReflection(n, lightDir, viewDir, lightColor.rgb, shininess);\n  vec3 finalColor = baseColor * (0.3 + lighting);\n  return vec4(finalColor, 1.0);\n}\nvoid main() { gl_FragColor = frag(); }"},"builtins":{"globals":{"blocks":[{"name":"CCGlobal","defines":[]},{"name":"CCCamera","defines":[]}],"samplerTextures":[],"buffers":[],"images":[]},"locals":{"blocks":[{"name":"CCLocal","defines":["USE_LOCAL"]}],"samplerTextures":[{"name":"cc_spriteTexture","defines":[]}],"buffers":[],"images":[]},"statistics":{"CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS":56,"CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS":5}},"defines":[{"name":"USE_LOCAL","type":"boolean"}]}],[{"name":"maps","passes":[{"program":"../demo/14-maps/maps|vs:vert|fs:frag","blendState":{"targets":[{"blend":true,"blendSrc":2,"blendDst":4}]},"depthStencilState":{"depthTest":false,"depthWrite":false},"properties":{"heightMap":{"value":"white","type":28},"normalMap":{"value":"white","type":28},"lightPos":{"type":14,"value":[0.5,0.5]},"lightColor":{"type":16,"value":[1,1,1,1]},"shininess":{"type":13,"value":[15]},"reflectMode":{"type":5,"value":[1]},"useHeight":{"type":5,"value":[0]}}}]}]]],0,0,[],[],[]]]]
